<!--
 * Copyright (c) 2013 Jun-Wei Lin	
 * Licensed under the Creative Commons Attribution Non-Commercial Share Alike License
 * http://creativecommons.org/licenses/by-nc-sa/3.0/
-->
<!DOCTYPE html>
<html>
<head>
<style>
body
{
	 background: black; 
	 font-family:Helvetica;
}

div
{
	position:absolute;
	left:50%;
	top:50%;
	text-align:center;
	color: silver;
}

P
{
	color: gold;
	font-size: 40%;
}

p button
{
	font-size: 70%;
}

@media screen and (min-width: 800px)
{
	div
	{
		width: 800px;
		margin-left:-400px;
		font-size: 65px;
	}
	button
	{
		font-size: 50px;
	}
}

@media screen and (max-width: 800px)
{
	div
	{
		width: 400px;
		margin-left:-200px;
		font-size: 35px;
	}
	button
	{
		font-size: 25px;
	}
}

@media screen and (min-height: 600px)
{
	div
	{
		height: 600px;
		margin-top:-300px;
	}
}

@media screen and (max-height: 600px)
{
	div
	{
		height: 300px;
		margin-top:-150px;
	}
}
</style>
</head>
<body onload="triggerTimer()" onbeforeunload="saveTime()">
<div>
<h1 id="demo"></h1>
<button onclick="pauseTimer()" id="btnPause">Pause</button>
<button onclick="triggerTimer()" id="btnResume">Resume</button>
<button onclick="resetTimer()" id="btnReset">Reset</button>
<p id="prev"></p>
</div>
<script>

	var time = new Array(0,0,0); // hh,mm,ss	
	var timerID;
	var t = getParameterByName("t");
	if (t)
	{
		for (var i=0;i<time.length;i++)
		{
			time[i] = parseInt(t.substr(i*2, 2));
		}
	}
	
	if (window.localStorage.prevDate)
	{
		document.getElementById("prev").innerHTML = "Last Record: " 
			+ checkTime(window.localStorage.prevH) + ":"
			+ checkTime(window.localStorage.prevM) + ":"
			+ checkTime(window.localStorage.prevS) + " "
			+ "(" + window.localStorage.prevDate + ") " 
			+ "<button onclick='loadTime()'>Load</button>";
	}
	
	function triggerTimer()
	{
		timerID = setInterval(function(){myTimer()},1000);
		
		document.getElementById("btnResume").disabled=true;
		document.getElementById("btnPause").disabled=false;
		document.getElementById("btnReset").disabled=true;
	}
	
	function pauseTimer()
	{
		window.clearInterval(timerID);
		
		document.getElementById("btnResume").disabled=false;
		document.getElementById("btnPause").disabled=true;
		document.getElementById("btnReset").disabled=false;
	}
	
	function resetTimer()
	{
		document.getElementById("btnResume").disabled=false;
		document.getElementById("btnPause").disabled=true;
		document.getElementById("btnResume").disabled=false;
		
		for (var i=0;i<time.length;i++)
		{
			time[i] = 0;
		}
		
		outputTimer();
	}
	
	function myTimer()
	{
		// second += 1 and then carry
		time[2] += 1;
		if (time[2] > 59)
		{
			time[1] += 1;
			time[2] = 0;
		}
		if (time[1] > 59)
		{
			time[0] += 1;
			time[1] = 0;
		}
		if (time[0]>99)
		{
			time[0] = 0;
		}
		
		outputTimer();
	}
	
	function outputTimer()
	{
		document.getElementById("demo").innerHTML = checkTime(time[0]) + ":" + checkTime(time[1]) + ":" + checkTime(time[2]);
		document.title = checkTime(time[0]) + ":" + checkTime(time[1]) + ":" + checkTime(time[2]);
	}
	
	function checkTime(t)
	{
		if (t<10) t = "0" + t;
		return t
	}
	
	function getParameterByName(name) // http://stackoverflow.com/questions/901115/how-can-i-get-query-string-values
	{
		name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
		var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
			results = regex.exec(location.search);
		return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
	}

	function saveTime()
	{
		var d = new Date();
		window.localStorage.prevDate = d.toDateString().slice(4); // "Sat Aug 17 2013" --> "Aug 17 2013"
		window.localStorage.prevH = time[0];
		window.localStorage.prevM = time[1];
		window.localStorage.prevS = time[2];
		//localStorage.clear();
	}
	
	function loadTime()
	{
		time[0] = parseInt(window.localStorage.prevH);
		time[1] = parseInt(window.localStorage.prevM);
		time[2] = parseInt(window.localStorage.prevS);
		
		outputTimer();
	}
</script>
</body>
</html>
